<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>امتحان أنظمة التشغيل (Mid 2021-2022)</title>
    <!-- تحميل Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Cairo', sans-serif;
        }
        .correct {
            background-color: #16a34a !important; /* bg-green-600 */
            color: white !important;
            border-color: #22c55e; /* border-green-500 */
            border-width: 2px;
        }
        .incorrect {
            background-color: #dc2626 !important; /* bg-red-600 */
            color: white !important;
            border-color: #ef4444; /* border-red-500 */
            border-width: 2px;
        }
        .hidden {
            display: none;
        }
        /* تنسيق للأسئلة التي تفتقد للبيانات */
        .missing-data-note {
            font-size: 0.9rem;
            color: #f59e0b; /* text-amber-500 */
            margin-top: 8px;
            display: block;
            font-style: italic;
        }
        /* تنسيق صورة السؤال */
        #question-image {
            max-width: 300px; /* حجم مناسب للصورة */
            height: auto;
            margin: 1rem auto 0;
            border-radius: 0.5rem;
            border: 2px solid #4b5563;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="bg-gray-800 rounded-2xl shadow-2xl p-6 sm:p-10 w-full max-w-3xl">

        <!-- حاوية الاختبار -->
        <div id="quiz-container">
            <header class="text-center mb-6">
                <h1 class="text-3xl font-bold text-cyan-400">امتحان أنظمة التشغيل (Mid 2021-2022)</h1>
                <p id="progress" class="text-lg text-gray-400 mt-2"></p>
            </header>

            <!-- منطقة السؤال -->
            <div class="bg-gray-900 p-6 rounded-lg shadow-inner min-h-[100px]">
                <h2 id="question" class="text-2xl font-semibold text-center leading-relaxed" dir="ltr"></h2>
                <img id="question-image" src="" alt="Question Image" class="hidden"/>
            </div>

            <!-- منطقة الخيارات -->
            <div id="options-container" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-8">
                <!-- سيتم ملء الخيارات هنا عبر جافاسكريبت -->
            </div>

            <!-- منطقة الإفادة (صحيح/خاطئ) -->
            <div id="feedback" class="text-center text-xl font-bold mt-6 min-h-[2rem]">
                <!-- سيتم عرض الإفادة هنا -->
            </div>

            <!-- زر التالي -->
            <button id="next-btn" class="hidden bg-cyan-600 text-white font-bold py-3 px-8 rounded-lg mt-8 w-full hover:bg-cyan-700 transition-colors duration-300 shadow-lg text-lg">
                التالي
            </button>
        </div>

        <!-- حاوية النتائج (مخفية افتراضيًا) -->
        <div id="results-container" class="hidden text-center">
            <h2 class="text-4xl font-bold text-cyan-400 mb-4">اكتمل الاختبار!</h2>
            <p id="score" class="text-3xl text-white mb-8"></p>
            <button id="restart-btn" class="bg-gray-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-gray-700 transition-colors duration-300 shadow-lg text-lg">
                إعادة الاختبار
            </button>
        </div>
    </div>

    <script>
        // --- 1. تعريف الأسئلة (من ملف PDF الخاص بـ Mid 2021-2022) ---
        // ملاحظة: بعض الأسئلة تفتقد لجداول البيانات، تم إضافة ملاحظة لها
        const allQuestions = [
            { question: "There are five processes A to E... Arrival: 0, 1, 3, 9, 12. Processing: 3, 5, 2, 5, 5. What is the turnaround time of process C using first-come-first-served scheduling? <span class='missing-data-note'>(Processes: A, B, C, D, E)</span>", type: 'mcq', options: ['3', '6', '7', '8', '9', '10', '11', '20'], answer: '7' },
            { question: "Suppose that a process is in \"BLOCKED\" state waiting for some I/O service. When the device is completed, it goes to the", type: 'mcq', options: ['BLOCKED state', 'READY state', 'SUSPENDED state', 'TERMINATED state'], answer: 'READY state' },
            { question: "A semaphore used as a mutual exclusion lock by a pair of processes should be initialized to", type: 'mcq', options: ['0', '1', '2', 'Others'], answer: '1' },
            { question: "The following system of four processes with two resources: (Alloc: P1(1 3), P2(4 1), P3(1 2), P4(2 0)) (Request: P1(1 2), P2(4 3), P3(1 7), P4(5 1)). If the availability vector is [2 4], is the system above deadlocked? <span class='missing-data-note'>(بيانات الجدول مضافة من النص)</span>", type: 'mcq', options: ['Yes', 'No'], answer: 'No' },
            { question: "The list of processes waiting for a particular I/O device is called a(n)", type: 'mcq', options: ['standby queue', 'device queue', 'ready queue', 'interrupt queue'], answer: 'device queue' },
            { question: "A situation where several processes access and manipulate the same data concurrently and the outcome of the execution depends on the order in which the access takes place, is called a", type: 'mcq', options: ['convoy effect', 'disorder problem', 'critical-section problem', 'race condition'], answer: 'race condition' },
            { question: "The following system of four processes with two resources: (Alloc: P1(1 3), P2(4 1), P3(1 2), P4(2 0)) (Request: P1(1 2), P2(4 3), P3(1 7), P4(5 1)). If the availability vector is [2 3], is the system above deadlocked? <span class='missing-data-note'>(بيانات الجدول مضافة من النص)</span>", type: 'mcq', options: ['Yes', 'No'], answer: 'Yes' },
            { question: "The ... refers to the number of processes in memory", type: 'mcq', options: ['process count', 'long-term scheduler', 'degree of multi-programming', 'CPU scheduler'], answer: 'degree of multi-programming' },
            { question: "Consider the following pseudo-code: boolean flag[2]; flag[0]=flag[1]=false; proc(int i) { while(true) { while(flag [(i+1) mod 2] == true); flag[i] = true; critical_section; flag[i] = false; } } ... does this solve the critical section problem?", type: 'mcq', options: ['Yes', 'No'], answer: 'No' },
            { question: "Bootstrap program is kept in the dynamic RAM memory of the computer", type: 'tf', answer: false },
            { question: "test_and_set is applicable to any number of processes not just two processes", type: 'tf', answer: true },
            { question: "There are five processes A to E... Arrival: 0, 1, 3, 9, 12. Processing: 3, 5, 2, 5, 5. What is the turnaround time of process E using Shortest-job-first scheduling? <span class='missing-data-note'>(Processes: A, B, C, D, E)</span>", type: 'mcq', options: ['3', '6', '7', '8', '9', '10', '11', '20'], answer: '8' },
            { question: "lock = 0; R = compare_and_swap(&lock, 0, 1); The values of lock and R after executing the previous pseudo-code are:", type: 'mcq', options: ['lock = 0, R = 0', 'lock = 0, R = 1', 'lock = 1, R = 0', 'lock = 1, R = 1', 'Others'], answer: 'lock = 1, R = 0' },
            { question: "There are five processes A to E... Arrival: 0, 1, 3, 9, 12. Processing: 3, 5, 2, 5, 5. What is the turnaround time of process B using round-robin (with 1 second quantum) scheduling? <span class='missing-data-note'>(Processes: A, B, C, D, E)</span>", type: 'mcq', options: ['3', '6', '7', '8', '9', '10', '11', '20'], answer: '10' },
            { question: "Critical section is", type: 'mcq', options: ['a part of the operating system which is not allowed to be accessed by any process', 'a set of instructions that access common shared resource which exclude one another in time', 'a part of the kernel that interfaces to the device controllers', 'none of the above'], answer: 'a set of instructions that access common shared resource which exclude one another in time' },
            { question: "The two processes in following resource allocation graph are:", type: 'mcq', options: ['deadlocked', 'Not deadlocked'], answer: 'deadlocked', image: 'https://i.imgur.com/gYl8C1n.png' }, // رابط بديل للصورة من ملف PDF
            { question: "In the readers/writers problem we want to allow multiple writers to be in their critical sections for the shared data at the same time.", type: 'tf', answer: false },
            { question: "The two separate modes of operating in a system are", type: 'mcq', options: ['supervisor mode and system mode', 'kernel mode and privileged mode', 'physical mode and logical mode', 'user mode and kernel mode'], answer: 'user mode and kernel mode' },
            { question: "The two fundamental models of interprocess communication are message passing and shared memory", type: 'tf', answer: true },
            { question: "The cache is managed by", type: 'mcq', options: ['Compiler', 'Hardware', 'Operating system', 'Others'], answer: 'Hardware' }
        ];

        // --- 2. الإشارة إلى عناصر الصفحة ---
        const quizContainer = document.getElementById('quiz-container');
        const resultsContainer = document.getElementById('results-container');
        const questionEl = document.getElementById('question');
        const questionImageEl = document.getElementById('question-image'); // تم الإضافة
        const optionsContainer = document.getElementById('options-container');
        const progressEl = document.getElementById('progress');
        const feedbackEl = document.getElementById('feedback');
        const nextBtn = document.getElementById('next-btn');
        const scoreEl = document.getElementById('score');
        const restartBtn = document.getElementById('restart-btn');

        // --- 3. متغيرات حالة الاختبار ---
        let currentQuestionIndex = 0;
        let score = 0;
        let answerSelected = false;

        // --- 4. وظائف الاختبار ---

        /** بدء الاختبار أو إعادة تشغيله */
        function startQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            answerSelected = false;
            resultsContainer.classList.add('hidden');
            quizContainer.classList.remove('hidden');
            nextBtn.classList.add('hidden');
            loadQuestion();
        }

        /** تحميل السؤال الحالي */
        function loadQuestion() {
            answerSelected = false; 
            feedbackEl.textContent = ''; 
            nextBtn.classList.add('hidden'); 
            optionsContainer.innerHTML = ''; 
            questionImageEl.classList.add('hidden'); // إخفاء الصورة افتراضيًا

            const currentQuestion = allQuestions[currentQuestionIndex];
            
            progressEl.textContent = `السؤال ${currentQuestionIndex + 1} من ${allQuestions.length}`;
            questionEl.innerHTML = currentQuestion.question; 
            questionEl.dir = "ltr";

            // إظهار الصورة إذا كانت موجودة في السؤال
            if (currentQuestion.image) {
                questionImageEl.src = currentQuestion.image;
                questionImageEl.classList.remove('hidden');
                // معالجة خطأ تحميل الصورة
                questionImageEl.onerror = () => { 
                    questionImageEl.classList.add('hidden');
                    console.error('Failed to load image:', currentQuestion.image);
                };
            }
            
            // إنشاء أزرار الخيارات
            if (currentQuestion.type === 'mcq') {
                const optionsCount = currentQuestion.options.length;
                if (optionsCount <= 2) {
                    optionsContainer.className = 'grid grid-cols-1 sm:grid-cols-2 gap-4 mt-8';
                } else if (optionsCount <= 4) {
                    optionsContainer.className = 'grid grid-cols-1 sm:grid-cols-2 gap-4 mt-8';
                } else {
                     optionsContainer.className = 'grid grid-cols-1 sm:grid-cols-2 gap-4 mt-8'; // تنسيق لـ 5+ خيارات
                }
                
                currentQuestion.options.forEach(option => {
                    const button = createOptionButton(option, option);
                    optionsContainer.appendChild(button);
                });
            } else if (currentQuestion.type === 'tf') {
                optionsContainer.className = 'grid grid-cols-2 gap-4 mt-8';
                const trueButton = createOptionButton('True', true);
                const falseButton = createOptionButton('False', false);
                optionsContainer.appendChild(trueButton);
                optionsContainer.appendChild(falseButton);
            }
        }

        /** إنشاء زر خيار */
        function createOptionButton(text, value) {
            const button = document.createElement('button');
            button.textContent = text;
            button.dataset.value = value; 
            button.className = "bg-gray-700 p-4 rounded-lg text-left w-full transition-all duration-200 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-500 text-white text-lg ltr:text-left rtl:text-right";
            button.dir = "ltr"; 
            if (text === 'True' || text === 'False' || text === 'Yes' || text === 'No' || !isNaN(text)) {
                 button.classList.add("text-center");
            }

            button.addEventListener('click', () => selectAnswer(button));
            return button;
        }

        /** معالجة اختيار الإجابة */
        function selectAnswer(selectedButton) {
            if (answerSelected) return; 
            answerSelected = true;

            const currentQuestion = allQuestions[currentQuestionIndex];
            const selectedValue = selectedButton.dataset.value;
            
            const correctAnswer = currentQuestion.answer;
            let isCorrect;

            if (currentQuestion.type === 'tf') {
                isCorrect = (selectedValue === String(correctAnswer));
            } else {
                isCorrect = (selectedValue === correctAnswer);
            }

            Array.from(optionsContainer.children).forEach(btn => {
                btn.disabled = true;
                btn.classList.add('opacity-70', 'cursor-not-allowed');
            });

            if (isCorrect) {
                score++;
                selectedButton.classList.add('correct');
                feedbackEl.textContent = 'إجابة صحيحة!';
                feedbackEl.className = 'text-center text-xl font-bold mt-6 min-h-[2rem] text-green-500';
            } else {
                selectedButton.classList.add('incorrect');
                feedbackEl.textContent = 'إجابة خاطئة!';
                feedbackEl.className = 'text-center text-xl font-bold mt-6 min-h-[2rem] text-red-500';

                const correctValue = String(correctAnswer);
                const correctButton = Array.from(optionsContainer.children).find(btn => btn.dataset.value === correctValue);
                if (correctButton) {
                    correctButton.classList.add('correct');
                }
            }

            nextBtn.classList.remove('hidden');
        }

        /** الانتقال للسؤال التالي أو إظهار النتائج */
        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < allQuestions.length) {
                loadQuestion();
            } else {
                showResults();
            }
        }

        /** إظهار شاشة النتائج النهائية */
        function showResults() {
            quizContainer.classList.add('hidden');
            resultsContainer.classList.remove('hidden');
            scoreEl.textContent = `لقد حصلت على ${score} من ${allQuestions.length}`;
        }

        // --- 5. ربط الأحداث ---
        nextBtn.addEventListener('click', nextQuestion);
        restartBtn.addEventListener('click', startQuiz);

        // --- 6. بدء الاختبار عند تحميل الصفحة ---
        startQuiz();
    </script>
</body>
</html>