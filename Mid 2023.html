<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>امتحان أنظمة التشغيل (Mid 2023)</title>
    <!-- تحميل Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Cairo', sans-serif;
        }
        .correct {
            background-color: #16a34a !important; /* bg-green-600 */
            color: white !important;
            border-color: #22c55e; /* border-green-500 */
            border-width: 2px;
        }
        .incorrect {
            background-color: #dc2626 !important; /* bg-red-600 */
            color: white !important;
            border-color: #ef4444; /* border-red-500 */
            border-width: 2px;
        }
        .hidden {
            display: none;
        }
        /* تنسيق للأسئلة التي تفتقد للبيانات */
        .missing-data-note {
            font-size: 0.9rem;
            color: #f59e0b; /* text-amber-500 */
            margin-top: 8px;
            display: block;
            font-style: italic;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="bg-gray-800 rounded-2xl shadow-2xl p-6 sm:p-10 w-full max-w-3xl">

        <!-- حاوية الاختبار -->
        <div id="quiz-container">
            <header class="text-center mb-6">
                <h1 class="text-3xl font-bold text-cyan-400">امتحان أنظمة التشغيل (Mid 2023)</h1>
                <p id="progress" class="text-lg text-gray-400 mt-2"></p>
            </header>

            <!-- منطقة السؤال -->
            <div class="bg-gray-900 p-6 rounded-lg shadow-inner min-h-[100px] flex items-center justify-center">
                <h2 id="question" class="text-2xl font-semibold text-center leading-relaxed" dir="ltr"></h2>
            </div>

            <!-- منطقة الخيارات -->
            <div id="options-container" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-8">
                <!-- سيتم ملء الخيارات هنا عبر جافاسكريبت -->
            </div>

            <!-- منطقة الإفادة (صحيح/خاطئ) -->
            <div id="feedback" class="text-center text-xl font-bold mt-6 min-h-[2rem]">
                <!-- سيتم عرض الإفادة هنا -->
            </div>

            <!-- زر التالي -->
            <button id="next-btn" class="hidden bg-cyan-600 text-white font-bold py-3 px-8 rounded-lg mt-8 w-full hover:bg-cyan-700 transition-colors duration-300 shadow-lg text-lg">
                التالي
            </button>
        </div>

        <!-- حاوية النتائج (مخفية افتراضيًا) -->
        <div id="results-container" class="hidden text-center">
            <h2 class="text-4xl font-bold text-cyan-400 mb-4">اكتمل الاختبار!</h2>
            <p id="score" class="text-3xl text-white mb-8"></p>
            <button id="restart-btn" class="bg-gray-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-gray-700 transition-colors duration-300 shadow-lg text-lg">
                إعادة الاختبار
            </button>
        </div>
    </div>

    <script>
        // --- 1. تعريف الأسئلة (من ملف PDF الخاص بـ Mid 2023) ---
        const allQuestions = [
            { question: "If a process must loop repeatedly, keeping the CPU occupied, to wait for a condition, that is called:", type: 'mcq', options: ['starvation', 'livelock', 'deadlock', 'busy waiting', 'mutual exclusion', 'coroutine'], answer: 'busy waiting' },
            { question: "Given the following processes and burst times... (Processes are assumed to have arrived all at time 0). What is the turnaround time of process P5 using the Round Robin (RR, quantum = 2 milliseconds)? <span class='missing-data-note'>(ملاحظة: بيانات الجدول مفقودة من المصدر)</span>", type: 'mcq', options: ['17 milliseconds'], answer: '17 milliseconds' },
            { question: "Given the following processes and burst times... (Processes are assumed to have arrived all at time 0). What is the waiting time of process P5 using the Round Robin (RR, quantum = 2 milliseconds)? <span class='missing-data-note'>(ملاحظة: بيانات الجدول مفقودة من المصدر)</span>", type: 'mcq', options: ['12 milliseconds'], answer: '12 milliseconds' },
            { question: "In Readers & Writers problem, can the writers suffer from starvation?", type: 'mcq', options: ['Yes', 'No'], answer: 'Yes' },
            { question: "Preemptive scheduling allows a process to be interrupted in the midst of its execution, taking the CPU away and allocating it to another process.", type: 'tf', answer: true },
            { question: "Consider the following snapshot of a system: What is the content of the matrix Need? <span class='missing-data-note'>(ملاحظة: بيانات الجدول مفقودة من المصدر)</span>", type: 'mcq', options: ['Need = Max - Allocation (PO: 0000, P1: 0750, P2: 1002, P3: 0020, P4: 0642)', 'Other Matrix'], answer: 'Need = Max - Allocation (PO: 0000, P1: 0750, P2: 1002, P3: 0020, P4: 0642)' },
            { question: "Consider the following snapshot of a system: If a request from process P1 arrives for (0, 4, 2, 0), can the request be granted? <span class='missing-data-note'>(ملاحظة: بيانات الجدول مفقودة من المصدر)</span>", type: 'mcq', options: ["Can't accept the request because system will be in an unsafe state & P1 must wait.", "Accept the request"], answer: "Can't accept the request because system will be in an unsafe state & P1 must wait." },
            { question: "Given the following processes and burst times... (Processes are assumed to have arrived all at time 0). Which of the algorithms results in the minimal average waiting time? <span class='missing-data-note'>(ملاحظة: بيانات الجدول مفقودة من المصدر)</span>", type: 'mcq', options: ['SJF', 'RR', 'FCFS'], answer: 'SJF' },
            { question: "'Aging' is", type: 'mcq', options: ['keeping track of cache contents', 'keeping track of what pages are currently residing in the memory', 'keeping track of how many times a given page is referenced', 'increasing the priority of jobs to ensure termination in a finite time.'], answer: 'increasing the priority of jobs to ensure termination in a finite time.' },
            { question: "Given the following processes and burst times... (Processes are assumed to have arrived all at time 0). What is the turnaround time of process P5 using the Shortest Job First (SJF)? <span class='missing-data-note'>(ملاحظة: بيانات الجدول مفقودة من المصدر)</span>", type: 'mcq', options: ['11 milliseconds'], answer: '11 milliseconds' },
            { question: "Below the structure of the Readers & Writers problem is shown... What are the initial values of mutex, wrt, and readCount?", type: 'mcq', options: ['mutex = 1, wrt = 1, readCount = 0', 'mutex = 0, wrt = 0, readCount = 1', 'mutex = 1, wrt = 0, readCount = 0'], answer: 'mutex = 1, wrt = 1, readCount = 0' },
            { question: "Suppose that a process is in \"BLOCKED\" state waiting for some I/O service. When the device is completed, it goes to the", type: 'mcq', options: ['BLOCKED state', 'READY state', 'SUSPENDED state', 'TERMINATED state'], answer: 'READY state' },
            { question: "In the readers/writers problem, we want to allow a reader and a writer to be in their critical sections for the shared data at the same time.", type: 'tf', answer: false },
            { question: "If process A is waiting for a nonpreemptible resource that is held by process B and process B is waiting for a nonpreemptable resource that is held by A, that is called:", type: 'mcq', options: ['starvation', 'livelock', 'deadlock', 'busy waiting', 'mutual exclusion', 'coroutine'], answer: 'deadlock' },
            { question: "Consider the following snapshot of a system: Is the system in a safe state? If the system is safe, write a safe sequence. <span class='missing-data-note'>(ملاحظة: بيانات الجدول مفقودة من المصدر)</span>", type: 'mcq', options: ['< PO, P2, P1, P3, P4 >', 'Not safe'], answer: '< PO, P2, P1, P3, P4 >' },
            { question: "An unsafe state may not necessarily lead to deadlock", type: 'tf', answer: true },
            { question: "In the producer/consumer problem the producer never has to wait.", type: 'tf', answer: false },
            { question: "If processes A, B, and C are all requesting resource Rt but the operating system allows A and B to access R repeatedly while C continues to wait for R, that is called:", type: 'mcq', options: ['starvation', 'livelock', 'deadlock', 'busy waiting', 'mutual exclusion', 'coroutine'], answer: 'starvation' },
            { question: "A situation where several processes access and manipulate the same data concurrently and the outcome of the execution depends on the particular order in which the access takes place, is called a", type: 'mcq', options: ['convoy effect', 'disorder problem', 'critical-section problem', 'race condition'], answer: 'race condition' }
        ];


        // --- 2. الإشارة إلى عناصر الصفحة ---
        const quizContainer = document.getElementById('quiz-container');
        const resultsContainer = document.getElementById('results-container');
        const questionEl = document.getElementById('question');
        const optionsContainer = document.getElementById('options-container');
        const progressEl = document.getElementById('progress');
        const feedbackEl = document.getElementById('feedback');
        const nextBtn = document.getElementById('next-btn');
        const scoreEl = document.getElementById('score');
        const restartBtn = document.getElementById('restart-btn');

        // --- 3. متغيرات حالة الاختبار ---
        let currentQuestionIndex = 0;
        let score = 0;
        let answerSelected = false;

        // --- 4. وظائف الاختبار ---

        /** بدء الاختبار أو إعادة تشغيله */
        function startQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            answerSelected = false;
            resultsContainer.classList.add('hidden');
            quizContainer.classList.remove('hidden');
            nextBtn.classList.add('hidden');
            loadQuestion();
        }

        /** تحميل السؤال الحالي */
        function loadQuestion() {
            answerSelected = false; 
            feedbackEl.textContent = ''; 
            nextBtn.classList.add('hidden'); 
            optionsContainer.innerHTML = ''; 

            const currentQuestion = allQuestions[currentQuestionIndex];
            
            progressEl.textContent = `السؤال ${currentQuestionIndex + 1} من ${allQuestions.length}`;
            questionEl.innerHTML = currentQuestion.question; 
            questionEl.dir = "ltr";
            
            // إنشاء أزرار الخيارات
            if (currentQuestion.type === 'mcq') {
                const optionsCount = currentQuestion.options.length;
                if (optionsCount <= 2) {
                    optionsContainer.className = 'grid grid-cols-1 sm:grid-cols-2 gap-4 mt-8';
                } else if (optionsCount <= 4) {
                    optionsContainer.className = 'grid grid-cols-1 sm:grid-cols-2 gap-4 mt-8';
                } else {
                     optionsContainer.className = 'grid grid-cols-1 gap-4 mt-8'; // For more than 4 options
                }
                
                currentQuestion.options.forEach(option => {
                    const button = createOptionButton(option, option);
                    optionsContainer.appendChild(button);
                });
            } else if (currentQuestion.type === 'tf') {
                optionsContainer.className = 'grid grid-cols-2 gap-4 mt-8';
                const trueButton = createOptionButton('True', true);
                const falseButton = createOptionButton('False', false);
                optionsContainer.appendChild(trueButton);
                optionsContainer.appendChild(falseButton);
            }
        }

        /** إنشاء زر خيار */
        function createOptionButton(text, value) {
            const button = document.createElement('button');
            button.textContent = text;
            button.dataset.value = value; 
            button.className = "bg-gray-700 p-4 rounded-lg text-left w-full transition-all duration-200 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-500 text-white text-lg ltr:text-left rtl:text-right";
            button.dir = "ltr"; 
            if (text === 'True' || text === 'False' || text === 'Yes' || text === 'No' || !isNaN(text)) {
                 button.classList.add("text-center");
            }

            button.addEventListener('click', () => selectAnswer(button));
            return button;
        }

        /** معالجة اختيار الإجابة */
        function selectAnswer(selectedButton) {
            if (answerSelected) return; 
            answerSelected = true;

            const currentQuestion = allQuestions[currentQuestionIndex];
            const selectedValue = selectedButton.dataset.value;
            
            const correctAnswer = currentQuestion.answer;
            let isCorrect;

            if (currentQuestion.type === 'tf') {
                isCorrect = (selectedValue === String(correctAnswer));
            } else {
                isCorrect = (selectedValue === correctAnswer);
            }

            Array.from(optionsContainer.children).forEach(btn => {
                btn.disabled = true;
                btn.classList.add('opacity-70', 'cursor-not-allowed');
            });

            if (isCorrect) {
                score++;
                selectedButton.classList.add('correct');
                feedbackEl.textContent = 'إجابة صحيحة!';
                feedbackEl.className = 'text-center text-xl font-bold mt-6 min-h-[2rem] text-green-500';
            } else {
                selectedButton.classList.add('incorrect');
                feedbackEl.textContent = 'إجابة خاطئة!';
                feedbackEl.className = 'text-center text-xl font-bold mt-6 min-h-[2rem] text-red-500';

                const correctValue = String(correctAnswer);
                // تعديل: التأكد من أن المحدد يعمل بشكل صحيح مع النصوص
                const correctButton = Array.from(optionsContainer.children).find(btn => btn.dataset.value === correctValue);
                if (correctButton) {
                    correctButton.classList.add('correct');
                }
            }

            nextBtn.classList.remove('hidden');
        }

        /** الانتقال للسؤال التالي أو إظهار النتائج */
        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < allQuestions.length) {
                loadQuestion();
            } else {
                showResults();
            }
        }

        /** إظهار شاشة النتائج النهائية */
        function showResults() {
            quizContainer.classList.add('hidden');
            resultsContainer.classList.remove('hidden');
            scoreEl.textContent = `لقد حصلت على ${score} من ${allQuestions.length}`;
        }

        // --- 5. ربط الأحداث ---
        nextBtn.addEventListener('click', nextQuestion);
        restartBtn.addEventListener('click', startQuiz);

        // --- 6. بدء الاختبار عند تحميل الصفحة ---
        startQuiz();
    </script>
</body>
</html>